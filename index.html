<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¯Ø±Ø¯Ø´ØªÙŠ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background: #e5ddd5;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .header {
      background: #075e54;
      color: white;
      padding: 12px;
      text-align: center;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .tabs {
      display: flex;
      background: #075e54;
      padding: 0;
    }
    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      color: rgba(255,255,255,0.7);
    }
    .tab.active {
      color: white;
      font-weight: bold;
    }
    .chat {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .msg {
      max-width: 70%;
      padding: 8px 12px;
      border-radius: 8px;
      word-wrap: break-word;
    }
    .in { background: #fff; align-self: flex-start; }
    .out { background: #dcf8c6; align-self: flex-end; }
    .ai { background: #fff8dc; align-self: flex-start; }
    .input-area {
      display: flex;
      padding: 8px;
      background: #fff;
      gap: 8px;
    }
    .input-area input {
      flex: 1;
      padding: 10px;
      border: none;
      background: #f0f0f0;
      border-radius: 20px;
    }
    .input-area button {
      border: none;
      background: #075e54;
      color: white;
      padding: 0 16px;
      border-radius: 20px;
    }
    .voice-btn, .status-btn, .ai-btn {
      background: #6c757d;
      padding: 0 12px;
      border-radius: 20px;
      font-size: 20px;
      cursor: pointer;
    }
    .ai-container {
      display: none;
      flex: 1;
      flex-direction: column;
    }
    .ai-container.active {
      display: flex;
    }
    .status-preview {
      max-width: 80%;
      margin: 10px auto;
      padding: 10px;
      background: white;
      border-radius: 10px;
      text-align: center;
    }
    .status-input {
      width: 90%;
      margin: 10px auto;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div class="header">
    <span>Ø¯Ø±Ø¯Ø´ØªÙŠ ğŸŒ</span>
    <div style="display:flex;gap:8px;">
      <button class="ai-btn" onclick="toggleAI()">ğŸ¤– AI</button>
    </div>
  </div>
  
  <div class="tabs">
    <div class="tab active" onclick="switchTab('family')">Ø¹Ø§Ø¦Ù„Ø©</div>
    <div class="tab" onclick="switchTab('public')">Ø¹Ø§Ù…Ø©</div>
    <div class="tab" onclick="switchTab('status')">Ø­Ø§Ù„Ø§Øª</div>
  </div>

  <!-- Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
  <div id="family-chat" class="chat active"></div>
  <div id="public-chat" class="chat"></div>
  
  <!-- Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„Ø§Øª -->
  <div id="status-section" class="chat" style="display:none;">
    <div class="status-input">
      <input type="text" id="statusText" placeholder="Ø§ÙƒØªØ¨ Ø­Ø§Ù„ØªÙƒ..." />
      <button onclick="postStatus()">Ù†Ø´Ø± Ø§Ù„Ø­Ø§Ù„Ø©</button>
    </div>
    <div id="statusFeed"></div>
  </div>
  
  <!-- Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ -->
  <div id="ai-chat" class="ai-container">
    <div class="chat" id="ai-messages">
      <div class="msg ai"><b>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:</b> Ù…Ø±Ø­Ø¨Ù‹Ø§! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>
    </div>
    <div class="input-area">
      <input type="text" id="ai-input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..." onkeypress="if(event.key==='Enter') sendAI()" />
      <button onclick="sendAI()">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
  </div>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <div class="input-area" id="main-input">
    <input type="text" id="msg" placeholder="Ø§ÙƒØªØ¨..." onkeypress="if(event.key==='Enter') sendText()" />
    <button onclick="sendText()">Ø¥Ø±Ø³Ø§Ù„</button>
    <button class="voice-btn" onclick="recordAudio()">ğŸ¤</button>
    <button class="status-btn" onclick="showStatusModal()">ğŸ“¸ Ø­Ø§Ù„Ø©</button>
  </div>

  <script>
    // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    let currentTab = 'family';
    let messages = {
      family: JSON.parse(localStorage.getItem('family') || '[]'),
      public: JSON.parse(localStorage.getItem('public') || '[]'),
      status: JSON.parse(localStorage.getItem('status') || '[]')
    };
    let aiMessages = JSON.parse(localStorage.getItem('ai') || '[]');

    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    function displayMessages() {
      ['family', 'public'].forEach(tab => {
        const chat = document.getElementById(tab + '-chat');
        chat.innerHTML = '';
        messages[tab].forEach(msg => {
          const div = document.createElement('div');
          div.className = msg.self ? 'msg out' : 'msg in';
          div.innerHTML = `<b>${msg.name}:</b> ${msg.text || ''}`;
          if (msg.audio) {
            div.innerHTML += `<br><audio controls src="${msg.audio}" style="width:100%; margin-top:5px;"></audio>`;
          }
          chat.appendChild(div);
        });
        chat.scrollTop = chat.scrollHeight;
      });
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª
      const statusFeed = document.getElementById('statusFeed');
      statusFeed.innerHTML = '';
      messages.status.forEach(status => {
        const div = document.createElement('div');
        div.className = 'status-preview';
        div.innerHTML = `<b>${status.name}</b><br>${status.text}`;
        statusFeed.appendChild(div);
      });
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
    function switchTab(tab) {
      currentTab = tab;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      
      document.getElementById('family-chat').style.display = tab === 'family' ? 'flex' : 'none';
      document.getElementById('public-chat').style.display = tab === 'public' ? 'flex' : 'none';
      document.getElementById('status-section').style.display = tab === 'status' ? 'block' : 'none';
      document.getElementById('main-input').style.display = tab === 'status' ? 'none' : 'flex';
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
    function sendText() {
      const text = document.getElementById('msg').value.trim();
      if (!text) return;
      
      const msg = {
        name: localStorage.name || 'Ø²Ø§Ø¦Ø±',
        text: text,
        self: true,
        time: Date.now()
      };
      
      messages[currentTab].push(msg);
      localStorage.setItem(currentTab, JSON.stringify(messages[currentTab]));
      displayMessages();
      document.getElementById('msg').value = '';
    }

    // ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª
    async function recordAudio() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const mediaRecorder = new MediaRecorder(stream);
        const chunks = [];
        mediaRecorder.ondataavailable = e => chunks.push(e.data);
        mediaRecorder.start();
        setTimeout(() => {
          mediaRecorder.stop();
          stream.getTracks().forEach(track => track.stop());
        }, 5000);

        mediaRecorder.onstop = () => {
          const blob = new Blob(chunks, { type: 'audio/webm' });
          const url = URL.createObjectURL(blob);
          const msg = {
            name: localStorage.name || 'Ø²Ø§Ø¦Ø±',
            audio: url,
            self: true,
            time: Date.now()
          };
          messages[currentTab].push(msg);
          localStorage.setItem(currentTab, JSON.stringify(messages[currentTab]));
          displayMessages();
        };
      } catch (err) {
        alert('Ù„Ù… ÙŠØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†: ' + err.message);
      }
    }

    // Ù†Ø´Ø± Ø§Ù„Ø­Ø§Ù„Ø©
    function postStatus() {
      const text = document.getElementById('statusText').value.trim();
      if (!text) return;
      
      const status = {
        name: localStorage.name || 'Ø²Ø§Ø¦Ø±',
        text: text,
        time: Date.now()
      };
      
      messages.status.push(status);
      localStorage.setItem('status', JSON.stringify(messages.status));
      document.getElementById('statusText').value = '';
      displayMessages();
    }

    // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø§Ù„Ø©
    function showStatusModal() {
      switchTab('status');
    }

    // Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
    function toggleAI() {
      const aiContainer = document.getElementById('ai-chat');
      const mainInput = document.getElementById('main-input');
      const tabs = document.querySelector('.tabs');
      
      if (aiContainer.classList.contains('active')) {
        aiContainer.classList.remove('active');
        mainInput.style.display = 'flex';
        tabs.style.display = 'flex';
      } else {
        aiContainer.classList.add('active');
        mainInput.style.display = 'none';
        tabs.style.display = 'none';
      }
    }

    function sendAI() {
      const input = document.getElementById('ai-input');
      const text = input.value.trim();
      if (!text) return;
      
      // Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const userMsg = {
        text: text,
        self: true
      };
      aiMessages.push(userMsg);
      
      // Ø¥Ø¶Ø§ÙØ© Ø±Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Ù…Ø­Ø§ÙƒØ§Ø©)
      const aiResponses = [
        "Ù‡Ø°Ø§ Ø³Ø¤Ø§Ù„ Ù…Ù…ØªØ§Ø²! Ø¯Ø¹Ù†ÙŠ Ø£ÙÙƒØ±...",
        "Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø¹Ø±ÙØªÙŠØŒ Ø£Ù‚ØªØ±Ø­ Ø£Ù†...",
        "Ø£ÙÙ‡Ù… Ù…Ø§ ØªÙ‚ØµØ¯. Ø¥Ù„ÙŠÙƒ Ù…Ø§ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù‚ÙˆÙ„Ù‡...",
        "Ø´ÙƒØ±Ù‹Ø§ Ù„Ø³Ø¤Ø§Ù„Ùƒ! Ø§Ù„Ø¬ÙˆØ§Ø¨ Ù‡Ùˆ...",
        "Ù‡Ø°Ø§ Ù…ÙˆØ¶ÙˆØ¹ Ù…Ø«ÙŠØ± Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù…. Ø±Ø£ÙŠÙŠ Ø£Ù†...",
        "Ù„Ù‚Ø¯ Ø¨Ø­Ø«Øª ÙÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØŒ ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡ÙŠ..."
      ];
      
      setTimeout(() => {
        const aiMsg = {
          text: aiResponses[Math.floor(Math.random() * aiResponses.length)],
          self: false
        };
        aiMessages.push(aiMsg);
        localStorage.setItem('ai', JSON.stringify(aiMessages));
        displayAIMessages();
      }, 1000);
      
      input.value = '';
    }

    function displayAIMessages() {
      const chat = document.getElementById('ai-messages');
      chat.innerHTML = '<div class="msg ai"><b>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:</b> Ù…Ø±Ø­Ø¨Ù‹Ø§! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>';
      aiMessages.forEach(msg => {
        const div = document.createElement('div');
        div.className = msg.self ? 'msg out' : 'msg ai';
        div.innerHTML = `<b>${msg.self ? 'Ø£Ù†Øª' : 'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ'}:</b> ${msg.text}`;
        chat.appendChild(div);
      });
      chat.scrollTop = chat.scrollHeight;
    }

    // Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
    if (!localStorage.name) {
      localStorage.name = prompt('Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ:') || 'Ø²Ø§Ø¦Ø±';
    }
    displayMessages();
  </script>
</body>
  </html>
