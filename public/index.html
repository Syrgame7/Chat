<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¯Ø±Ø¯Ø´ØªÙŠ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background: #e5ddd5;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .header { background: #075e54; color: white; padding: 12px; text-align: center; font-weight: bold; }
    .chat { flex: 1; overflow-y: auto; padding: 12px; display: flex; flex-direction: column; gap: 8px; }
    .msg { max-width: 70%; padding: 8px 12px; border-radius: 8px; word-wrap: break-word; }
    .in { background: #fff; align-self: flex-start; }
    .out { background: #dcf8c6; align-self: flex-end; }
    .input-area { display: flex; padding: 8px; background: #fff; gap: 8px; }
    .input-area input { flex: 1; padding: 10px; border: none; background: #f0f0f0; border-radius: 20px; }
    .input-area button { border: none; background: #075e54; color: white; padding: 0 16px; border-radius: 20px; }
    .voice-btn { background: #6c757d; padding: 0 12px; border-radius: 20px; font-size: 20px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="header">Ø¯Ø±Ø¯Ø´ØªÙŠ ğŸŒ</div>
  <div class="chat" id="chat"></div>
  <div class="input-area">
    <input type="text" id="msg" placeholder="Ø§ÙƒØªØ¨..." />
    <button onclick="sendText()">Ø¥Ø±Ø³Ø§Ù„</button>
    <button class="voice-btn" onclick="recordAudio()">ğŸ¤</button>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>

  <script>
    // ğŸ‘‡ Ø§Ù„ØµÙ‚ ÙƒÙˆØ¯ Firebase Ù‡Ù†Ø§ (Ù…Ù† Ø§Ù„Ø®Ø·ÙˆØ© 2)
    const firebaseConfig = {
  apiKey: "AIzaSyAoyJk6vUqmRWS1Y_24PWH4DksULqfh8Jg",
  authDomain: "chat-voice-b20d7.firebaseapp.com",
  projectId: "chat-voice-b20d7",
  storageBucket: "chat-voice-b20d7.firebasestorage.app",
  messagingSenderId: "419287060625",
  appId: "1:419287060625:web:229e52427ac6cd381fef30",
  measurementId: "G-6P2K4V5051"
};
    // ØªÙ‡ÙŠØ¦Ø© Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();

    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    db.ref('messages').on('child_added', (snapshot) => {
      const msg = snapshot.val();
      const div = document.createElement('div');
      div.className = msg.uid === getUid() ? 'msg out' : 'msg in';
      div.innerHTML = `<b>${msg.name}:</b> ${msg.text || ''}`;
      if (msg.audioUrl) {
        div.innerHTML += `<br><audio controls src="${msg.audioUrl}" style="width:100%; margin-top:5px;"></audio>`;
      }
      document.getElementById('chat').appendChild(div);
      div.scrollIntoView();
    });

    function getUid() {
      return localStorage.uid || (localStorage.uid = Date.now().toString(36));
    }

    function sendText() {
      const text = document.getElementById('msg').value.trim();
      if (!text) return;
      db.ref('messages').push({
        name: localStorage.name || 'Ø²Ø§Ø¦Ø±',
        text: text,
        uid: getUid(),
        time: Date.now()
      });
      document.getElementById('msg').value = '';
    }

    async function recordAudio() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const mediaRecorder = new MediaRecorder(stream);
      const chunks = [];
      mediaRecorder.ondataavailable = e => chunks.push(e.data);
      mediaRecorder.start();
      setTimeout(() => {
        mediaRecorder.stop();
        stream.getTracks().forEach(track => track.stop());
      }, 5000); // Ø³Ø¬Ù„ 5 Ø«ÙˆØ§Ù†Ù

      mediaRecorder.onstop = async () => {
        const blob = new Blob(chunks, { type: 'audio/webm' });
        const filename = `audio/${Date.now()}.webm`;
        const uploadTask = storage.ref(filename).put(blob);
        const snapshot = await uploadTask;
        const audioUrl = await snapshot.ref.getDownloadURL();
        db.ref('messages').push({
          name: localStorage.name || 'Ø²Ø§Ø¦Ø±',
          audioUrl: audioUrl,
          uid: getUid(),
          time: Date.now()
        });
      };
    }

    // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    if (!localStorage.name) {
      const name = prompt('Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ:') || 'Ø²Ø§Ø¦Ø±';
      localStorage.name = name;
    }
  </script>
</body>
</html>
